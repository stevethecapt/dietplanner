<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diet Planning System</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <div class="flash-messages container">
      {% for category, msg in messages %}
      <div class="flash {{ category }}">{{ msg }}</div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}

    <header>
      <nav>
        <div class="logo">DietPlanner</div>
        <ul>
          <li><a href="#home">Home</a></li>
          <li><a href="#features">Features</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#contact">Contact</a></li>
          {% if session.get('username') %}
          <li><a href="#" id="userBtn">{{ session['username'] }}</a></li>
          {% else %}
          <li><a href="{{ url_for('login') }}">Login</a></li>
          <li><a href="{{ url_for('signup') }}">SignUp</a></li>
          {% endif %}
        </ul>
      </nav>
    </header>
      <div id="userPopup" class="user-popup hidden">
        <p><strong>Name:</strong> <span id="popupFullname"></span></p>
        <p><strong>Email:</strong> <span id="popupEmail"></span></p>
        <p><strong>Joined:</strong> <span id="popupJoined"></span></p>
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
      </div>
      <script src="{{ url_for('static', filename='user_popup.js') }}"></script>

    <section id="home" class="hero">
      <div class="hero-content">
        <h1>Plan Your Perfect Diet</h1>
        <p>
          Achieve your health goals with personalized diet plans tailored just
          for you.
        </p>

        {% if session.get('username') %}
        <a href="{{ url_for('dietplanner') }}" class="btn-primary"
          >Get Started</a
        >
        {% else %}
        <!-- Unauthenticated: show modal confirm instead of direct link -->
        <a href="#" id="get-started-btn" class="btn-primary">Get Started</a>
        {% endif %}
      </div>
      <div class="hero-image">
        <img
          src="https://via.placeholder.com/600x400/4CAF50/FFFFFF?text=Healthy+Foods"
          alt="Healthy Foods"
        />
      </div>
    </section>

    <section id="features" class="features">
      <h2>Key Features</h2>
      <div class="feature-grid">
        <div class="feature-card">
          <div class="icon">üçé</div>
          <h3>Personalized Plans</h3>
          <p>Get diet plans based on your goals, preferences, and lifestyle.</p>
        </div>
        <div class="feature-card">
          <div class="icon">üìä</div>
          <h3>Track Progress</h3>
          <p>
            Monitor your intake and see real-time progress towards your targets.
          </p>
        </div>
      </div>
    </section>

    <footer>
      <p>&copy; 2023 DietPlanner. All rights reserved.</p>
    </footer>
    <!-- Modal for unauthenticated Get Started -->
    <div id="auth-modal" class="modal" aria-hidden="true">
      <div class="modal-backdrop" id="modal-backdrop"></div>
      <div
        class="modal-panel"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modal-title"
      >
        <h3 id="modal-title">Perlu Login</h3>
        <p>
          Anda harus login untuk melanjutkan ke fitur Diet Planner. Ingin login
          sekarang?
        </p>
        <div class="modal-actions">
          <button id="modal-cancel" class="btn-secondary">Batal</button>
          <button id="modal-ok" class="btn-primary">OK</button>
        </div>
      </div>
    </div>

    <script>
      (function () {
        var btn = document.getElementById("get-started-btn");
        var modal = document.getElementById("auth-modal");
        var backdrop = document.getElementById("modal-backdrop");
        var ok = document.getElementById("modal-ok");
        var cancel = document.getElementById("modal-cancel");
        if (btn && modal) {
          function show() {
            modal.setAttribute("aria-hidden", "false");
            modal.style.display = "block";
            document.body.style.overflow = "hidden";
          }
          function hide() {
            modal.setAttribute("aria-hidden", "true");
            modal.style.display = "none";
            document.body.style.overflow = "auto";
          }
          btn.addEventListener("click", function (e) {
            e.preventDefault();
            show();
          });
          cancel.addEventListener("click", function (e) {
            e.preventDefault();
            hide();
          });
          backdrop.addEventListener("click", function () {
            hide();
          });
          ok.addEventListener("click", function () {
            window.location = "{{ url_for('login') }}";
          });
        }
      })();
    </script>
  </body>
</html>
